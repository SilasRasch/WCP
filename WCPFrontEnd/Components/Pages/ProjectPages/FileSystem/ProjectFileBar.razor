@using WCPShared.Models.Entities.ProjectModels
@inject IDialogService DialogService

@* Breadcrumbs *@
<MudStack Row>
    <MudText Class="cursor-pointer" @onclick="@(() => GoToPath(string.Empty))">Home</MudText>

    @if (!string.IsNullOrEmpty(_path)) 
    {
        @if (!_path.Contains("/"))
        {
            <MudText>/</MudText>
            <MudText Class="cursor-pointer" @onclick="@(() => GoToPath(_path))">@(_path.First().ToString().ToUpper() + _path.Substring(1))</MudText>
        }
        else
        {
            @for (int i = 0; i < _path.Split('/').Count() - 1; i++)
            {
                <MudText>/</MudText>
                <MudText Class="cursor-pointer" @onclick="@(() => GoToPath(string.Join('/', _path.Split('/').Take(i))))">@(_path.Split('/')[i].Trim().First().ToString().ToUpper() + _path.Split('/')[i].Substring(1))</MudText>
            }
        }
    }

    @* @if (_path.Contains("scripts")) 
    {
        <MudText>/</MudText>
        <MudText Class="cursor-pointer" @onclick="@(() => GoToPath("scripts"))">Scripts</MudText>
    }


    @if (_path.Contains("content"))
    {
        <MudText>/</MudText>
        <MudText Class="cursor-pointer" @onclick="@(() => GoToPath("content"))">Content</MudText>

        @if (_path.Contains("audio"))
        {
            <MudText>/</MudText>
            <MudText Class="cursor-pointer" @onclick="@(() => GoToPath("content/audio"))">Audio</MudText>
        }

        @if (_path.Contains("visuals"))
        {
            <MudText>/</MudText>
            <MudText Class="cursor-pointer" @onclick="@(() => GoToPath("content/visuals"))">Visuals</MudText>
        }
    }

    @if (_path.Contains("product"))
    {
        <MudText>/</MudText>
        <MudText Class="cursor-pointer" @onclick="@(() => GoToPath("product"))">Product</MudText>
    }

    @if (_path.Contains("other"))
    {
        <MudText>/</MudText>
        <MudText Class="cursor-pointer" @onclick="@(() => GoToPath("other"))">Other</MudText>
    } *@
</MudStack>

<MudGrid Spacing="0" Justify="Justify.Center" Class="my-2 p-4 mud-secondary rounded-lg gap-2">
    @if (_path == string.Empty) 
    {
        if (Project is CreatorProject) 
        {
            <MudFab StartIcon="@Icons.Material.Filled.Folder" IconSize="Size.Large" Class="mud-background" Label="Scripts" OnClick="@(() => GoToPath("scripts"))" />
            <MudFab StartIcon="@Icons.Material.Filled.Folder" IconSize="Size.Large" Class="mud-background" Label="Content" OnClick="@(() => GoToPath("content"))" />
        }
                
        <MudFab StartIcon="@Icons.Material.Filled.Folder" IconSize="Size.Large" Class="mud-background" Label="Product" OnClick="@(() => GoToPath("product"))" />
        <MudFab StartIcon="@Icons.Material.Filled.Folder" IconSize="Size.Large" Class="mud-background" Label="Other" OnClick="@(() => GoToPath("other"))" />

        
    }

    @if (Project is CreatorProject creatorProject) 
    {
        @if (_path == "scripts")
        {
            @foreach (string str in creatorProject.Scripts)
            {
                <MudFab StartIcon="@Icons.Material.Filled.Note" IconSize="Size.Large" Class="mud-background" Label="@str" />
            }
            <MudFab StartIcon="@Icons.Material.Filled.Upload" IconSize="Size.Large" Class="mud-background" Label="Upload" @onclick="@(() => ToggleUploadDialog(0))" />
        }

        @if (_path == "content")
        {
            <MudFab StartIcon="@Icons.Material.Filled.Folder" IconSize="Size.Large" Class="mud-background" Label="Audio" OnClick="@(() => GoToPath("content/audio"))" />
            <MudFab StartIcon="@Icons.Material.Filled.Folder" IconSize="Size.Large" Class="mud-background" Label="Visuals" OnClick="@(() => GoToPath("content/visuals"))" />
        }

        @if (_path == "content/audio")
        {
            @foreach (string str in creatorProject.Formats.Trim().Split(','))
            {
                <MudFab StartIcon="@Icons.Material.Filled.Folder" IconSize="Size.Large" Class="mud-background" Label="@str" OnClick="@(() => GoToPath($"content/audio/{str}"))" />
            }

            <MudFab StartIcon="@Icons.Material.Filled.UploadFile" IconSize="Size.Large" Class="mud-background" Label="Upload" @onclick="@(() => ToggleUploadDialog(1))" />
        }

        @if (_path == "content/visuals")
        {
            @foreach (string str in creatorProject.Formats.Trim().Split(','))
            {
                <MudFab StartIcon="@Icons.Material.Filled.Folder" IconSize="Size.Large" Class="mud-background" Label="@str" OnClick="@(() => GoToPath($"content/audio/{str}"))" />
            }
            <MudFab StartIcon="@Icons.Material.Filled.UploadFile" IconSize="Size.Large" Class="mud-background" Label="Upload" @onclick="@(() => ToggleUploadDialog(1))" />
        }
    }

    

    @if (_path == "product")
    {
        @foreach (string str in Project.Formats.Trim().Split(','))
        {
            <MudFab StartIcon="@Icons.Material.Filled.Note" IconSize="Size.Large" Class="mud-background" Label="@str" />
        }
        <MudFab StartIcon="@Icons.Material.Filled.UploadFile" IconSize="Size.Large" Class="mud-background" Label="Upload" @onclick="@(() => ToggleUploadDialog(2))" />
    }

    @if (_path == "other")
    {
        @* @foreach (string str in Project.OtherFiles) *@
        <MudFab StartIcon="@Icons.Material.Filled.UploadFile" IconSize="Size.Large" Class="mud-background" Label="Upload" @onclick="@(() => ToggleUploadDialog(3))" />
    }
</MudGrid>

@code {
    [Parameter]
    public Project Project { get; set; }

    private int _tabIndex;
    private string _path = string.Empty;

    private void GoToPath(string path) 
    {
        _path = path;
    }

    private async Task ToggleUploadDialog(int category)
    {
        var options = new DialogOptions { CloseOnEscapeKey = true };
        var parameters = new DialogParameters<Dialoges.FileUploadDialog>()
        {
            { x => x.Path, _path }
        };

        var dialog = await DialogService.ShowAsync<Dialoges.FileUploadDialog>("FileUploadDialog", parameters, options);
        var result = await dialog.Result;
    }
}