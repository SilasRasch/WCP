@using Microsoft.EntityFrameworkCore
@using WCPAdminFrontEnd.Services
@using WCPShared.Interfaces
@using WCPShared.Models.Entities
@using WCPShared.Models.Entities.UserModels
@using WCPShared.Models.Enums
@using WCPShared.Services
@inject IWcpDbContext Context
@inject StripeService StripeService

<MudSelect Variant="Variant.Outlined" @bind-Value="Type" Required Placeholder="Vælg et abonnement" RequiredError="Dette felt er påkrævet" AnchorOrigin="Origin.BottomCenter">
    <MudSelectItem Value="SubscriptionType.Small">Lille</MudSelectItem>
    <MudSelectItem Value="SubscriptionType.Medium">Standard</MudSelectItem>
    <MudSelectItem Value="SubscriptionType.Large">Stor</MudSelectItem>
</MudSelect>

<MudStack Class="mx-2 mb-3">
    <MudSlider Disabled="Value.NumberOfBrands == -1" Variant="Variant.Outlined" T="int" Size="Size.Large" @bind-Value="Value.NumberOfBrands" Step="1" Min="1" Max="10">Antal brands: @(Value.NumberOfBrands == -1 ? "Ubegrænset" : Value.NumberOfBrands)</MudSlider>
    <MudSlider Disabled="Value.NumberOfUsers == -1" Variant="Variant.Outlined" T="int" Size="Size.Large" @bind-Value="Value.NumberOfUsers" Step="1" Min="1" Max="10">Antal brugere: @(Value.NumberOfUsers == -1 ? "Ubegrænset" : Value.NumberOfUsers)</MudSlider>
</MudStack>

@code {
    [Parameter]
    public Subscription Value
    {
        get => _value;
        set
        {
            if (_value == value) return;

            _value = value;
            ValueChanged.InvokeAsync(value);
        }
    }

    [Parameter]
    public EventCallback<Subscription> ValueChanged { get; set; }

    private Subscription _value;

    [Parameter]
    public SubscriptionType Type
    {
        get => _type;
        set
        {
            if (_type == value) return;

            Value = StripeService.GetSubscriptionInfo(value);
            _type = value;
            TypeChanged.InvokeAsync(value);
        }
    }

    [Parameter]
    public EventCallback<SubscriptionType> TypeChanged { get; set; }

    private SubscriptionType _type;
}
